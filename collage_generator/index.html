<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collage Generator</title>
    <link rel="stylesheet" href="./styles/style.css">
    <style id="dynamic-styles">
        body, html {
            width: 100vw;
            min-height: 100vh;

            height: fit-content;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            display: grid;
            align-content: center;
            justify-items: center;
        }

        .box {
            width: 100%;
            height: 100%;
            aspect-ratio: 1 / 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .image {
            max-width: 100%;
            max-height: 100%;
        }


        .hide {
            display: none;
        }

        @media (min-width: 1000px) {
            .hide {
                display: block;
            }
        }
    </style>
</head>
<body>
    <section class="container"></section>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const container = document.querySelector(".container");

            const numRowsMobile = 2; // Set number of rows for Mobile
            const numColsMobile = 2; // Set number of columns for Mobile

            const numRowsDesktop = 3; // Set number of rows for Desktop
            const numColsDesktop = 6; // Set number of columns for Desktop

            const offsetXEven = 50; // Set offset x
            const offsetYEven = 50; // Set offset y
            const scaleEven = 1.2; // Set scale

            const offsetXOdd = 100; // Set offset x
            const offsetYOdd = 50; // Set offset y
            const scaleOdd = 0.9; // Set scale

            const scaleParam = 1; // Set scale down parameter

            const gapSize = "1% 1%"; // Set gap size

            const imageWidth = 50; // Set image width

            const containerWidth = 90; // Set container width
            const containerHeight = 90; // Set container width

            const aspectRatio = 1/1; // Set aspect ratio

            const breakPoint = 1000; // Set breakpoint

            let numImages;
            let visibleImages;

            if(numRowsMobile * numColsMobile > numRowsDesktop * numColsDesktop) {
                numImages = numRowsMobile * numColsMobile;
                visibleImages = numRowsDesktop * numColsDesktop;
            } else {
                numImages = numRowsDesktop * numColsDesktop;
                visibleImages = numRowsMobile * numColsMobile;
            }

            container.style.gap = gapSize;
            container.style.width = `${containerWidth}%`;
            container.style.height = `${containerHeight}%`;

            let numRows, numCols;

            function updateGridLayout() {
                if (window.innerWidth < 1000) {
                    container.style.gridTemplateColumns = `repeat(${numColsMobile}, 1fr)`;
                    container.style.gridTemplateRows = `repeat(${numRowsMobile}, 1fr)`;
                    numRows = numRowsMobile;
                    numCols = numColsMobile;
                } else {
                    container.style.gridTemplateColumns = `repeat(${numColsDesktop}, 1fr)`;
                    container.style.gridTemplateRows = `repeat(${numRowsDesktop}, 1fr)`;
                    numRows = numRowsDesktop;
                    numCols = numColsDesktop;
                }
            }

            for (let i = 0; i < numImages; i++) {
                let img = document.createElement("img");
                img.classList.add("image");
                let id = Math.floor(Math.random() * 200);
                img.src = `https://picsum.photos/id/${id}/200/300`;

                const div = document.createElement("div");
                div.classList.add("box");
                div.style.aspectRatio = `${aspectRatio}`;

                let row = Math.floor(i / numColsMobile); 
                let col = i % numColsMobile; 

                let offsetX, offsetY, scale;

                if ((row + col) % 2 === 0) { 
                    offsetX = (Math.random() - 0.5) * offsetXEven;
                    offsetY = (Math.random() - 0.5) * offsetYEven;
                    scale = Math.random() / scaleParam + scaleEven; 
                } else {
                    offsetX = (Math.random() - 0.5) * offsetXOdd;
                    offsetY = (Math.random() - 0.5) * offsetYOdd;
                    scale = Math.random() / scaleParam + scaleOdd;
                }

                img.style.width = `${imageWidth}%`;
                img.style.height = `auto`;
                img.style.transform = `translate(${offsetX}%, ${offsetY}%) scale(${scale})`;
                img.style.objectFit = "cover";

                div.appendChild(img);
                container.appendChild(div);
            }

            console.log(numImages, visibleImages);
            document.querySelectorAll(".box").forEach((box, index) => {
                if (index < visibleImages) {
                    box.classList.remove("hide");
                } else {
                    box.classList.add("hide");
                }
            });

            updateGridLayout(); 
            window.addEventListener("resize", updateGridLayout); 

            const  changeMediaQueryBreakpoint = (newBreakpoint) => {
                const styleSheet = document.getElementById("dynamic-styles").sheet;
                const rules = styleSheet.cssRules || styleSheet.rules;
                for (let i = 0; i < rules.length; i++) {
                    if (rules[i].media && rules[i].media.mediaText.includes("min-width")) {
                        styleSheet.deleteRule(i);
                        styleSheet.insertRule(`@media (min-width: ${newBreakpoint}px) { .hide { display: block; } }`, i);
                        break;
                    }
                }
            }

            changeMediaQueryBreakpoint(breakPoint);
        });
    </script>
</body>
</html>
